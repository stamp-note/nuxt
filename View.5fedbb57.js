import{u as U,_ as j}from"./user-coupon.19120cd4.js";import{k as x,X as V,Y as N,j as _,Z as M,q as w,I as B,av as O,aw as J,z as d,r as g,g as Y,o as q,a1 as E,w as v,b as m,R as r,ac as A,a as C,a2 as Z,d as $,ab as F}from"./entry.83bb345f.js";import{r as G,s as D}from"./index.581b0e8a.js";import{u as I}from"./_commonjsHelpers.172a11e0.js";import{_ as L}from"./default.vue.be0dafa8.js";import"./ThemeBtn.vue.b5160c40.js";import"./Icon.49032d3b.js";import"./StampWrap.f8075e8c.js";import"./Card.6e817d23.js";import"./nuxt-link.59e93abb.js";const P=x({props:{name:{type:String,default:null},size:{type:String,default:null,validator(e){return Object.keys(V.ui.formGroup.size).includes(e)}},label:{type:String,default:null},description:{type:String,default:null},required:{type:Boolean,default:!1},help:{type:String,default:null},error:{type:[String,Boolean],default:null},hint:{type:String,default:null},ui:{type:Object,default:()=>V.ui.formGroup}},setup(e,{slots:u}){const l=N(),t=_(()=>M({},e.ui,l.ui.formGroup));w("form-path",e.name);const c=B("form-errors",null),s=_(()=>{var n,a;return e.error&&typeof e.error=="string"?e.error:(a=(n=c==null?void 0:c.value)==null?void 0:n.find(o=>o.path===e.name))==null?void 0:a.message}),h=_(()=>O(u)),p=_(()=>h.value.map(n=>{var o;const a={};return s.value?(a.oldColor=(o=n.props)==null?void 0:o.color,a.color="red"):a.oldColor&&(a.color=a.oldColor),e.name&&(a.name=e.name),e.size&&(a.size=e.size),J(n,a)}));return()=>d("div",{class:[t.value.wrapper]},[e.label&&d("div",{class:[t.value.label.wrapper,t.value.size[e.size]]},[d("label",{for:e.name,class:[t.value.label.base,e.required&&t.value.label.required]},e.label),e.hint&&d("span",{class:[t.value.hint]},e.hint)]),e.description&&d("p",{class:[t.value.description,t.value.size[e.size]]},e.description),d("div",{class:[!!e.label&&t.value.container]},[...p.value,s.value?d("p",{class:[t.value.error,t.value.size[e.size]]},s.value):e.help?d("p",{class:[t.value.help,t.value.size[e.size]]},e.help):null])])}}),R=x({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]}},setup(e,{slots:u,expose:l}){const t=Math.random().toString(36).substring(7),c=G(`form-${t}`);c.on(async n=>{if(n.type==="blur"){const a=s.value.filter(i=>i.path!==n.path),o=(await h()).filter(i=>i.path===n.path);s.value=a.concat(o)}});const s=g([]);w("form-errors",s),w("form-events",c);async function h(){let n=await e.validate(e.state);if(e.schema)if(K(e.schema))n=n.concat(await ee(e.state,e.schema));else if(T(e.schema))n=n.concat(await H(e.state,e.schema));else if(ae(e.schema))n=n.concat(await ne(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return n}async function p(){if(s.value=await h(),s.value.length>0)throw new Error(`Form validation failed: ${JSON.stringify(s.value,null,2)}`);return e.state}return l({validate:p}),()=>{var n;return d("form",(n=u.default)==null?void 0:n.call(u))}}});function T(e){return e.validate&&e.__isYupSchema__}function X(e){return e.inner!==void 0}async function H(e,u){try{return await u.validate(e,{abortEarly:!1}),[]}catch(l){if(X(l))return l.inner.map(t=>({path:t.path??"",message:t.message}));throw l}}function K(e){return e.parse!==void 0}function W(e){return e.issues!==void 0}async function ee(e,u){try{return u.parse(e),[]}catch(l){if(W(l))return l.issues.map(t=>({path:t.path.join("."),message:t.message}));throw l}}function ae(e){return e.validateAsync!==void 0&&e.id!==void 0}function te(e){return e.isJoi===!0}async function ne(e,u){try{return await u.validateAsync(e,{abortEarly:!1}),[]}catch(l){if(te(l))return l.details.map(t=>({path:t.path.join("."),message:t.message}));throw l}}const le=[{label:"직접입력하기",value:"custom"},{label:"태어난 고향이 어디인가요?",value:"birth_location"},{label:"생일이 언제인가요?",value:"birth_date"},{label:"가장 좋아하는 음식은 무엇인가요?",value:"favorite_food"},{label:"가장 좋아하는 색상은 무엇인가요?",value:"favorite_color"},{label:"가장 좋아하는 동물은 무엇인가요?",value:"favorite_animal"},{label:"가장 좋아하는 영화는 무엇인가요?",value:"favorite_movie"},{label:"가장 좋아하는 책은 무엇인가요?",value:"favorite_book"},{label:"가장 좋아하는 음악은 무엇인가요?",value:"favorite_music"},{label:"가장 좋아하는 스포츠는 무엇인가요?",value:"favorite_sports"}],oe={class:"flex flex-col gap-2"},pe=x({__name:"View",setup(e){const u=U(),l=g("pt-2 px-3 text-xs text-red-500 dark:text-red-400 "),t=g({}),c=g();function s(){c.value.validate().then(n=>{var a,o;if(n){const i=t.value.name,b=((a=t.value.selectedQuestion)==null?void 0:a.value)==="custom"?t.value.question:(o=t.value.selectedQuestion)==null?void 0:o.label,y=t.value.answer;u.addUser(i,b,y),p(),F().$hideModal()}}).catch(()=>{})}const h=async n=>{var o;const a=[];if(!n.name)return a.push({path:"name",message:"이름을 입력해주세요"}),a;if(await u.hasUserName(n.name))return a.push({path:"name",message:"이미 존재하는 이름입니다 다른 이름을 입력해주세요"}),a;if(!(2<=n.name.length&&n.name.length<=20))return a.push({path:"name",message:"이름은 2글자 이상 20글자 이하로 입력해주세요"}),a;if(!n.selectedQuestion)return a.push({path:"selectedQuestion",message:"질문을 선택해주세요"}),a;if(((o=n.selectedQuestion)==null?void 0:o.value)==="custom"){if(!n.question)return a.push({path:"question",message:"질문을 입력해주세요"}),a;if(!(n.question.length<=50))return a.push({path:"question",message:"질문은 50글자 이하로 입력해주세요"}),a}return n.answer?(n.answer.length<=20||a.push({path:"answer",message:"답변은 20글자 이하로 입력해주세요"}),a):(a.push({path:"answer",message:"답변을 입력해주세요"}),a)};function p(){t.value={}}return Y(()=>{p()}),(n,a)=>{const o=j,i=P,b=D,y=I,k=R,Q=L;return q(),E(Q,{title:"내 쿠폰 만들기","hide-footer":""},{default:v(()=>[m(k,{ref_key:"form",ref:c,class:"m-4 flex flex-col gap-4",state:r(t),validate:h,onSubmit:A(s,["prevent"])},{default:v(()=>{var z,S;return[C("div",null,[m(i,{label:"이름",name:"name",ui:{error:r(l)}},{default:v(()=>[m(o,{modelValue:r(t).name,"onUpdate:modelValue":a[0]||(a[0]=f=>r(t).name=f),size:"lg",placeholder:"이름을 입력해주세요"},null,8,["modelValue"])]),_:1},8,["ui"])]),C("div",oe,[m(i,{label:"쿠폰 사용 시 본인 확인",name:"selectedQuestion",ui:{error:r(l)}},{default:v(()=>[m(b,{modelValue:r(t).selectedQuestion,"onUpdate:modelValue":a[1]||(a[1]=f=>r(t).selectedQuestion=f),size:"lg",placeholder:"질문을 선택해주세요",options:r(le),uiMenu:{height:"h-[120px]"}},null,8,["modelValue","options"])]),_:1},8,["ui"]),((S=(z=r(t))==null?void 0:z.selectedQuestion)==null?void 0:S.value)==="custom"?(q(),E(i,{key:0,name:"question",ui:{error:r(l)}},{default:v(()=>[m(o,{modelValue:r(t).question,"onUpdate:modelValue":a[2]||(a[2]=f=>r(t).question=f),size:"lg",placeholder:"질문을 입력해주세요"},null,8,["modelValue"])]),_:1},8,["ui"])):Z("",!0),m(i,{name:"answer",ui:{error:r(l)}},{default:v(()=>[m(o,{modelValue:r(t).answer,"onUpdate:modelValue":a[3]||(a[3]=f=>r(t).answer=f),size:"lg",placeholder:"질문에 대한 답변을 입력해주세요"},null,8,["modelValue"])]),_:1},8,["ui"])]),m(y,{type:"submit",size:"lg",block:""},{default:v(()=>[$(" 쿠폰 생성 ")]),_:1})]}),_:1},8,["state","onSubmit"])]),_:1})}}});export{pe as default};
